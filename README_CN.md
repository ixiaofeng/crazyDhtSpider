# crazyDhtSpider

![DHT Spider](https://neeko-copilot.bytedance.net/api/text2image?prompt=Distributed%20DHT%20web%20crawler%20architecture%20diagram%20with%20nodes%20and%20data%20flow%2C%20technical%20style%2C%20blue%20color%20scheme&image_size=square_hd)

æœ¬é¡¹ç›®æ˜¯åœ¨phpDhtSpideråŸºç¡€ä¸Šä¿®æ”¹è€Œæ¥ï¼š[https://github.com/cuijun123/phpDhtSpider](https://github.com/cuijun123/phpDhtSpider)

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

ä¸€ä¸ªåŸºäº PHP + Swoole å®ç°çš„åˆ†å¸ƒå¼ DHT ç½‘ç»œçˆ¬è™«ï¼Œæ—¨åœ¨é«˜æ•ˆæ”¶é›†å’Œå¤„ç† DHT ç½‘ç»œæ•°æ®ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- æœåŠ¡å™¨å·²è®¾ç½® `ulimit -n 65535`
- é˜²ç«å¢™å·²å¼€æ”¾æ‰€éœ€ç«¯å£
- Swoole å¯æ‰§è¡Œæ–‡ä»¶å·²æ”¾ç½®äºé¡¹ç›®æ ¹ç›®å½•

### å®‰è£…æ­¥éª¤

1. **å…‹éš†ä»“åº“**
   ```bash
   git clone https://github.com/ixiaofeng/crazyDhtSpider.git
   cd crazyDhtSpider
   ```

2. **ä¸‹è½½ Swoole å¯æ‰§è¡Œæ–‡ä»¶**
   - è®¿é—® [Swoole å®˜æ–¹ç½‘ç«™](https://www.swoole.com/)
   - ä¸‹è½½å¯¹åº”çš„ Swoole å¯æ‰§è¡Œæ–‡ä»¶
   - æ”¾ç½®äº `dht_client` å’Œ `dht_server` åŒçº§ç›®å½•

3. **é…ç½®é¡¹ç›®**
   - æ ¹æ®éœ€è¦ç¼–è¾‘ `dht_client/config.php` å’Œ `dht_server/config.php`
   - ç¡®ä¿æ•°æ®åº“è¿æ¥è®¾ç½®æ­£ç¡®

### è¿è¡Œçˆ¬è™«

#### dht_clientï¼ˆçˆ¬è™«æœåŠ¡å™¨ï¼‰

1. **è®¾ç½®æœåŠ¡å™¨é™åˆ¶**
   ```bash
   ulimit -n 65535
   ```

2. **å¼€æ”¾é˜²ç«å¢™ç«¯å£**
   ```bash
   # Ubuntu/Debian ç³»ç»Ÿç¤ºä¾‹
   ufw allow 6882/udp
   
   # CentOS/RHEL ç³»ç»Ÿç¤ºä¾‹
   firewall-cmd --permanent --add-port=6882/udp
   firewall-cmd --reload
   ```

3. **å¯åŠ¨å®¢æˆ·ç«¯**
   ```bash
   ./swoole-cli dht_client/client.php
   ```

4. **åœæ­¢å®¢æˆ·ç«¯**
   ```bash
   # æŸ¥æ‰¾è¿›ç¨‹
   ps aux|grep php_dht_client_master
   # ç»ˆæ­¢è¿›ç¨‹ï¼ˆä½¿ç”¨æŸ¥æ‰¾åˆ°çš„è¿›ç¨‹å·ï¼‰
   kill -2 <è¿›ç¨‹å·>
   ```

#### dht_serverï¼ˆæ•°æ®æ¥æ”¶æœåŠ¡å™¨ï¼‰

1. **è®¾ç½®æœåŠ¡å™¨é™åˆ¶**
   ```bash
   ulimit -n 65535
   ```

2. **å¼€æ”¾é˜²ç«å¢™ç«¯å£**ï¼ˆå¦‚æœæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åœ¨ä¸åŒæœºå™¨ä¸Šï¼‰
   ```bash
   # Ubuntu/Debian ç³»ç»Ÿç¤ºä¾‹
   ufw allow 2345/udp
   
   # CentOS/RHEL ç³»ç»Ÿç¤ºä¾‹
   firewall-cmd --permanent --add-port=2345/udp
   firewall-cmd --reload
   ```

3. **å¯åŠ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯**
   ```bash
   # å¯åŠ¨æœåŠ¡å™¨
   ./swoole-cli dht_server/server.php
   
   # å¯åŠ¨å®¢æˆ·ç«¯ï¼ˆåœ¨å¦ä¸€ä¸ªç»ˆç«¯æˆ–åå°è¿è¡Œï¼‰
   ./swoole-cli dht_client/client.php
   ```

4. **åœæ­¢æœåŠ¡å™¨**
   ```bash
   # æŸ¥æ‰¾è¿›ç¨‹
   ps aux|grep php_dht_server_master
   # ç»ˆæ­¢è¿›ç¨‹ï¼ˆä½¿ç”¨æŸ¥æ‰¾åˆ°çš„è¿›ç¨‹å·ï¼‰
   kill -2 <è¿›ç¨‹å·>
   ```

## ğŸ“ é¡¹ç›®ç»“æ„

```
crazyDhtSpider/
â”œâ”€â”€ dht_client/          # çˆ¬è™«å®¢æˆ·ç«¯ç›®å½•
â”‚   â”œâ”€â”€ client.php       # å®¢æˆ·ç«¯ä¸»è„šæœ¬
â”‚   â”œâ”€â”€ config.php       # å®¢æˆ·ç«¯é…ç½®
â”‚   â””â”€â”€ inc/             # å®¢æˆ·ç«¯åŒ…å«æ–‡ä»¶
â”œâ”€â”€ dht_server/          # æ•°æ®æœåŠ¡å™¨ç›®å½•
â”‚   â”œâ”€â”€ server.php       # æœåŠ¡å™¨ä¸»è„šæœ¬
â”‚   â”œâ”€â”€ config.php       # æœåŠ¡å™¨é…ç½®
â”‚   â””â”€â”€ inc/             # æœåŠ¡å™¨åŒ…å«æ–‡ä»¶
â”œâ”€â”€ import_infohash.php  # Infohashå¯¼å…¥Redisè„šæœ¬
â”œâ”€â”€ README.md            # è‹±æ–‡æ–‡æ¡£
â””â”€â”€ README_CN.md         # ä¸­æ–‡æ–‡æ¡£
```

## âš™ï¸ é…ç½®è¯´æ˜

### ä¸»è¦é…ç½®é€‰é¡¹

- `daemonize`: è®¾ç½®ä¸º `true` ä»¥åå°å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œ
- `server_port`: æœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ï¼š2345ï¼‰
- `client_port`: å®¢æˆ·ç«¯ä½¿ç”¨çš„ç«¯å£ï¼ˆé»˜è®¤ï¼š6882ï¼‰
- `database`: æ•°æ®åº“è¿æ¥è®¾ç½®

### Redis ä¼˜åŒ–ï¼ˆæ–°ç‰¹æ€§ï¼‰

é¡¹ç›®ç°åœ¨ä½¿ç”¨ Redis Set ç»“æ„å’ŒäºŒè¿›åˆ¶å­˜å‚¨æ¥å­˜å‚¨ infohashï¼Œå¯¹äº 1000 ä¸‡æ¡è®°å½•ï¼Œå†…å­˜ä½¿ç”¨å‡å°‘çº¦ 63.6%ã€‚

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æœåŠ¡å™¨è¦æ±‚**
   - å…·æœ‰è¶³å¤Ÿå¸¦å®½çš„ VPSï¼ˆæ¨èæ— é™æµé‡ï¼‰
   - è‡³å°‘ 1GB å†…å­˜ä»¥å¤„ç†ä¸­ç­‰æµé‡
   - SSD å­˜å‚¨ä»¥è·å¾—æ›´å¥½çš„æ•°æ®åº“æ€§èƒ½

2. **æ•°æ®åº“ä¼˜åŒ–**
   - æ•°æ®é‡å¢é•¿æ—¶å®ç°è¡¨åˆ†åŒº
   - ä¸ºé¢‘ç¹æŸ¥è¯¢çš„å­—æ®µä½¿ç”¨é€‚å½“çš„ç´¢å¼•
   - é«˜æµé‡åœºæ™¯è€ƒè™‘ä½¿ç”¨è¯»å†™åˆ†ç¦»

3. **æ‰©å±•å»ºè®®**
   - åœ¨ä¸åŒæœåŠ¡å™¨ä¸Šéƒ¨ç½²å¤šä¸ªå®¢æˆ·ç«¯å®ä¾‹
   - ä¸ºæœåŠ¡å™¨ç»„ä»¶ä½¿ç”¨è´Ÿè½½å‡è¡¡
   - ç›‘æ§ç³»ç»Ÿèµ„æºå¹¶æ ¹æ®éœ€è¦è°ƒæ•´

## ğŸš¨ å¸¸è§é—®é¢˜

1. **æ— æ³•é‡‡é›†åˆ°æ•°æ®**
   - ç¡®ä¿é˜²ç«å¢™å·²å¼€æ”¾ 6882 UDP ç«¯å£
   - æ£€æŸ¥æœåŠ¡å™¨é™åˆ¶è®¾ç½® `ulimit -n`

2. **é”™è¯¯æ—¥å¿—é‡å¤§**
   - é”™è¯¯æ—¥å¿—æ˜¯æ­£å¸¸çš„ï¼Œä¸å½±å“åŠŸèƒ½
   - ä½¿ç”¨å®šæ—¶ä»»åŠ¡æ¸…ç†å¤§æ—¥å¿—æ–‡ä»¶

3. **åˆå§‹æ•°æ®é‡‡é›†ç¼“æ…¢**
   - è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œå› ä¸ºçˆ¬è™«æ­£åœ¨æ„å»ºèŠ‚ç‚¹æ•°æ®åº“
   - éšç€å‘ç°æ›´å¤šèŠ‚ç‚¹ï¼Œæ€§èƒ½ä¼šé€æ¸æé«˜

## ğŸ“ æ³¨æ„äº‹é¡¹

1. çˆ¬è™«è¿è¡Œè¿‡ç¨‹ä¸­ä¼šç”Ÿæˆé”™è¯¯æ—¥å¿—ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼Œä¸å½±å“åŠŸèƒ½ã€‚
2. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å»ºè®®å¯ç”¨åå°å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ (`daemonize => true`)ã€‚
3. ç›‘æ§æ•°æ®åº“æ€§èƒ½ï¼Œå¿…è¦æ—¶å®ç°åˆ†åŒºã€‚
4. æœ¬å·¥å…·ä»…ç”¨äºå­¦ä¹ å’Œç ”ç©¶ç›®çš„ï¼Œä½œè€…ä¸å¯¹ä½¿ç”¨è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä»»ä½•çº çº·æˆ–æ³•å¾‹é—®é¢˜è´Ÿè´£ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·éšæ—¶æäº¤ Pull Requestã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº MIT è®¸å¯è¯å¼€æºã€‚
